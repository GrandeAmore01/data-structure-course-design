# 动态顶点操作功能说明

## 功能概述
本次更新为图数据结构可视化器添加了**动态添加/删除顶点**功能，用户可以在图创建后随时添加或删除顶点，删除顶点时会自动删除所有与该顶点相关的边。

---

## 更新内容

### 1. 核心模型层更新

#### Graph.java（抽象基类）
新增抽象方法：
- `public abstract void addVertex(String label)` - 添加新顶点
- `public abstract void removeVertex(int vertex)` - 删除顶点及相关边

#### AdjacencyMatrix.java（邻接矩阵实现）
- **addVertex()**: 创建更大的矩阵，复制原数据，新行列初始化为INFINITY
- **removeVertex()**: 创建更小的矩阵，跳过被删除的行列，自动重新映射顶点索引

#### AdjacencyList.java（邻接表实现）
- **addVertex()**: 在邻接表末尾添加新的空列表
- **removeVertex()**: 
  - 删除该顶点的邻接表
  - 从所有其他顶点的邻接表中移除指向该顶点的边
  - 自动重新映射所有顶点索引

---

### 2. 用户界面更新

在图控制面板的"创建图"区域和"边操作"区域之间新增**顶点操作区域**：

```
顶点操作:
┌─────────────────────────────────┐
│ 标签: [文本框] [添加顶点]按钮   │
│ 索引: [文本框] [删除顶点]按钮   │
└─────────────────────────────────┘
```

#### 控件说明：
- **标签文本框**: 输入新顶点的标签（可选，留空则使用数字索引）
- **添加顶点按钮**: 点击添加一个新顶点
- **索引文本框**: 输入要删除的顶点索引（数字）
- **删除顶点按钮**: 点击删除指定顶点

---

## 使用方法

### 添加顶点

1. **确保已创建图**（通过"创建图"区域）
2. 在"标签"文本框输入顶点标签（可选）
   - 示例：输入 "A"、"北京"、"Node5" 等
   - 留空则自动使用数字索引作为标签
3. 点击**"添加顶点"**按钮
4. 新顶点立即出现在可视化面板中，所有顶点自动重新布局

**限制**：
- 最多支持20个顶点
- 标签可以是任意字符串

---

### 删除顶点

1. **确保已创建图**
2. 在"索引"文本框输入要删除的顶点编号
   - 示例：输入 "2" 删除索引为2的顶点
   - 可在图信息区查看当前顶点索引范围
3. 点击**"删除顶点"**按钮
4. 该顶点及其所有关联边同时被删除
5. **重要**：索引大于被删除顶点的所有顶点索引会自动减1

**限制**：
- 不能删除最后一个顶点（至少保留1个顶点）
- 必须输入有效的顶点索引

**索引重映射示例**：
```
删除前: 顶点 0, 1, 2, 3, 4
删除顶点2后: 顶点 0, 1, 2(原3), 3(原4)
```

---

## 预期效果

### ✅ 添加顶点功能
1. **即时响应**：点击按钮后立即在画布上显示新顶点
2. **自动布局**：所有顶点按圆形重新均匀分布
3. **初始状态**：新顶点没有任何边
4. **可立即操作**：可以立即对新顶点进行添加边、运行算法等操作
5. **信息提示**：信息区显示"已添加顶点: X (索引: Y)"

### ✅ 删除顶点功能
1. **同步删除边**：该顶点的所有入边和出边同时被删除
2. **索引自动更新**：大于被删除索引的顶点索引自动减1
3. **标签保持**：顶点标签保持不变，只是索引更新
4. **自动布局**：剩余顶点自动重新布局
5. **信息提示**：信息区显示删除信息和索引更新提示

### ✅ 与现有功能兼容
- ✔ 图算法（DFS、BFS、最短路径、MST）正常工作
- ✔ 添加/删除边功能正常
- ✔ 点击交互添加/删除边正常
- ✔ 保存/加载功能正常
- ✔ DSL解析功能正常
- ✔ 动画播放时会先停止动画，避免冲突

---

## 操作示例

### 示例1：构建自定义图
```
1. 创建图：顶点数=3，类型=邻接矩阵，有向图
   → 得到顶点 0, 1, 2

2. 添加顶点：标签="北京"
   → 得到顶点 0, 1, 2, 3(北京)

3. 添加边：0→3, 1→3, 2→3 (权重=1.0)
   → 构建指向"北京"的星形图

4. 删除顶点：索引=1
   → 得到顶点 0, 1(原2), 2(原北京)
   → 边自动更新为：0→2
```

### 示例2：动态扩展图
```
1. 创建图：顶点数=1
   → 单个顶点 0

2. 逐个添加顶点：添加5次
   → 得到顶点 0, 1, 2, 3, 4, 5

3. 添加边：构建链式结构
   → 0→1→2→3→4→5

4. 运行BFS：起点=0
   → 验证算法正常工作
```

---

## 技术细节

### 索引重映射机制
删除顶点v后：
- 顶点索引 < v → 保持不变
- 顶点索引 == v → 被删除
- 顶点索引 > v → 自动减1

### 性能特性
- **邻接矩阵**：
  - 添加顶点：O(n²) - 需要复制整个矩阵
  - 删除顶点：O(n²) - 需要复制整个矩阵
  - 适合顶点数较少的场景
  
- **邻接表**：
  - 添加顶点：O(1) - 只需添加新列表
  - 删除顶点：O(n+e) - 需要遍历所有边
  - 更适合频繁添加/删除顶点

### 安全机制
- 动画运行时执行顶点操作会先停止动画
- 输入验证：索引范围检查、顶点数量上限检查
- 错误提示友好：清晰的错误信息

---

## 注意事项

⚠️ **重要提示**：
1. **索引变化**：删除顶点后，部分顶点的索引会改变，请注意更新后的索引
2. **边自动删除**：删除顶点时，所有关联的边会一起被删除，无法恢复
3. **无撤销功能**：当前版本不支持撤销操作，请谨慎删除
4. **动画停止**：执行顶点操作时会停止正在运行的算法动画

---

## 测试建议

### 基础测试
1. ✅ 创建空图（1个顶点），然后逐个添加顶点
2. ✅ 创建完整图，然后逐个删除顶点
3. ✅ 添加顶点后立即添加边
4. ✅ 删除有边的顶点，验证边被同步删除

### 算法兼容性测试
1. ✅ 添加顶点后运行DFS/BFS
2. ✅ 添加顶点后运行最短路径算法
3. ✅ 删除顶点后运行MST算法（无向图）

### 边界测试
1. ✅ 尝试添加第21个顶点（应提示错误）
2. ✅ 尝试删除最后一个顶点（应提示错误）
3. ✅ 尝试删除不存在的索引（应提示错误）
4. ✅ 在动画运行时添加/删除顶点（应先停止动画）

---

## 未来增强方向（可选）

- 📌 支持按标签删除顶点
- 📌 支持拖拽顶点调整位置（自定义布局）
- 📌 支持批量添加/删除顶点
- 📌 添加撤销/重做功能
- 📌 添加顶点操作历史记录

---

## 总结

本次更新成功实现了图数据结构的动态顶点管理功能，使用户能够更灵活地构建和修改图结构。所有功能已通过编译验证，与现有系统完全兼容。

**开始使用**：运行项目后，在图控制面板找到"顶点操作"区域即可体验新功能！

---

*更新日期：2025-11-27*
*版本：1.1.0*


